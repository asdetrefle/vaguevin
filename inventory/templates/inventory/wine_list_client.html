{% extends "inventory/base.html" %}
{% load i18n %}

{% block title %}Wine List — {{ wine_list.uuid }}{% endblock %}

{% block style %}
<style>
    .wine-list-header {
        background: #e8e8e8;
        padding: 12px 24px;
        border-bottom: 1px solid #ddd;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .wine-list-header h2 {
        margin: 0;
        font-size: 20px;
        font-weight: 600;
    }

    .wine-list-header .status {
        font-size: 14px;
        font-weight: 500;
        color: #666;
        background: #f9f9f9;
        padding: 6px 12px;
        border-radius: 6px;
    }

    .wine-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 16px;
    }

    .wine-table th, .wine-table td {
        text-align: left;
        padding: 10px 16px;
        border-bottom: 1px solid #eee;
    }

    .wine-table th {
        background: #fafafa;
        font-weight: 600;
        cursor: pointer;
    }

    .wine-table tr:hover {
        background: #f6f6f6;
    }

    .footer-bar {
        position: fixed;
        bottom: 0;
        left: 0; right: 0;
        background: #ffffff;
        border-top: 1px solid #e0e0e0;
        padding: 12px 24px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        box-shadow: 0 -2px 4px rgba(0, 0, 0, 0.05);
        z-index: 100;
    }

    .footer-actions {
        display: flex;
        gap: 12px;
    }

    .footer-actions button {
        background: #007bff;
        color: white;
        padding: 8px 16px;
        font-size: 14px;
        border-radius: 4px;
        text-decoration: none;
        border: none; cursor: pointer;
    }

    .footer-actions button:hover {
        background: #0056b3;
    }

    .footer-actions button:disabled {
        background: #ccc;
        cursor: not-allowed;
    }
</style>
{% endblock %}

{% block content %}
<div class="wine-list-header">
    <h2>{% trans "Wine List" %} — {{ wine_list.uuid }}</h2>
    <div class="status">
        {% trans "Status" %}: {{ wine_list.get_status_display }}
    </div>
</div>

<div class="table-container">
    <table class="wine-table" id="wineListTable">
        <thead>
            <tr>
                <th>{% trans "Name" %}</th>
                <th>{% trans "Vintage" %}</th>
                <th>{% trans "Category" %}</th>
                <th>{% trans "Region" %}</th>
                <th>{% trans "Appellation" %}</th>
                <th>{% trans "Bottle Size (cl)" %}</th>
                <th>{% trans "Offer Price (€)" %}</th>
                <th>{% trans "Offer Qty" %}</th>
                <th>{% trans "Note" %}</th>
            </tr>
        </thead>
        <tbody>
            {% for item in display_items %}
            <tr>
                <td>{{ item.name }}</td>
                <td>{{ item.vintage|default:"—" }}</td>
                <td>{{ item.category|title }}</td>
                <td>{{ item.region|default:"—" }}</td>
                <td>{{ item.appellation|default:"—" }}</td>
                <td>{{ item.bottle_size }}</td>
                <td>{{ item.offer_price|floatformat:0 }}</td>
                <td>{{ item.offer_qty }}</td>
                <td>{{ item.note|default:"" }}</td>
            </tr>
            {% empty %}
            <tr><td colspan="9" style="text-align:center; color:#999;">{% trans "No wines in this list." %}</td></tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<div class="footer-bar">
    <div>{% trans "Total items" %}: {{ display_items|length }}</div>
    <div class="footer-actions">
        {% if wine_list.status == "created" %}
            <button onclick="submitWineList()">{% trans "Submit Wine List" %}</button>
        {% elif wine_list.status == "submitted" %}
            <button disabled>{% trans "Awaiting Payment" %}</button>
        {% elif wine_list.status == "confirmed" %}
            <button disabled>{% trans "Pending Delivery" %}</button>
        {% elif wine_list.status == "delivered" %}
            <button disabled>{% trans "Delivered" %}</button>
        {% elif wine_list.status == "finalized" %}
            <button disabled>{% trans "Finalized" %}</button>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
function submitWineList() {
    if (!confirm("Submit this wine list?")) return;
    fetch("{% url 'submit_wine_list' wine_list.uuid %}", {
        method: "POST",
        headers: {
            "X-CSRFToken": "{{ csrf_token }}"
        }
    })
    .then(res => res.json())
    .then(data => {
        if (data.success) location.reload();
        else alert("Failed to submit list");
    });
}
</script>
{% endblock %}
